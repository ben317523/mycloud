import{_ as h,a as w}from"./TheFileTable.60d76abf.js";import{_ as f,g,T as u,r,o as F,h as p,a as c,n as b,i as _,j as P,v,F as y}from"./index.215449f9.js";import"./index.e3edb5c8.js";const C={components:{TheFileViewer:h,CancellableProcess:g,TheFileTable:w,TheSystemInfo:u},data(){return{allFile:[],downloadFileName:"",dialogVisible:!1,previewName:"",downloadPercentage:0,showDownloadProcess:!1,controller:new AbortController,sysInfo:{total:0,used:0,free:0}}},computed:{downloadConfig(){var o=this;return{responseType:"blob",onDownloadProgress:function(e){if(e.lengthComputable){o.showDownloadProcess=!0;var l=Math.round(e.loaded*100/e.total);o.downloadPercentage=l}},signal:o.controller.signal}}},created(){this.getSysInfo(),this.getAllPublicFileInfo()},methods:{getSysInfo(){var o=this;o.$request.get("/sysInfo").then(e=>{e.data.code==0?(o.sysInfo.total=e.data.data.total,o.sysInfo.used=e.data.data.used,o.sysInfo.free=e.data.data.free):o.$message.error(e.data.msg)}).catch(e=>{o.$message.error(e)})},getAllPublicFileInfo(){var o=this;o.$request.get("/getAllFiles").then(e=>{e.data.code==0?(o.allFile=e.data.data,console.log(o.allFile)):o.$message.error(e.data.msg)}).catch(e=>{o.$message.error(e.message+" "+e.code)})},download(o){var e=this;this.downloadFileName=o,this.$request.get(`/download?param=${e.downloadFileName}&isPublic=true`,e.downloadConfig).then(l=>{const{data:s,headers:a}=l,n=a["content-disposition"].replace(/\w+;\s+filename="(.*)"/,"$1"),d=new Blob([s],{type:a["content-type"]});let t=document.createElement("a"),i=window.URL.createObjectURL(d);t.href=i,t.download=decodeURI(n),t.style.display="none",document.body.appendChild(t),t.click(),t.parentNode.removeChild(t),window.URL.revokeObjectURL(i)}).catch(l=>{}).finally(()=>{e.showDownloadProcess=!1,e.downloadPercentage=0})},deleteFile(o){var e=this;e.$confirm("the file will be deleted. Continue?","Warning",{confirmButtonText:"OK",cancelButtonText:"Cancel",type:"warning"}).then(()=>{e.$request.delete(`/delete?name=${o}&uname=${this.$cookies.get("name")}`).then(l=>{l.data.code==0?(e.$message.success(l.data.msg),e.getAllPublicFileInfo()):e.$message.error(l.data.msg)}).catch(l=>{e.$message.error(l.message)})}).catch(()=>{})},previewFile(o){var e=this;e.previewName=o,e.dialogVisible=!0},closePreview(o){var e=this;e.dialogVisible=!1,e.previewName=""},formatSize(o){let e=o/1024;if(Math.round(e)>1024){let l=e.toFixed(6)/1024;if(Math.round(l)>1024){let s=l.toFixed(6)/1024;return parseFloat(s).toFixed(3)+" GB"}return parseFloat(l).toFixed(3)+" MB"}return parseFloat(e).toFixed(3)+" KB"},cancelDownload(){var o=this;o.controller.abort(),o.showDownloadProcess=!1,o.downloadPercentage=0,o.controller=new AbortController,o.$message.warning("Cancel")}}};function T(o,e,l,s,a,n){const d=r("TheFileViewer"),t=r("TheSystemInfo"),i=r("CancellableProcess"),m=r("TheFileTable");return F(),p(y,null,[c(d,{dialogVisible:a.dialogVisible,fileName:a.previewName,onCloseDialog:n.closePreview},null,8,["dialogVisible","fileName","onCloseDialog"]),c(t,b(_(a.sysInfo)),null,16),P(c(i,{processPercentage:a.downloadPercentage,onCancelProcess:n.cancelDownload},null,8,["processPercentage","onCancelProcess"]),[[v,a.showDownloadProcess]]),c(m,{allFile:a.allFile,onDownload:n.download,onPreviewFile:n.previewFile,onDeleteFile:n.deleteFile},null,8,["allFile","onDownload","onPreviewFile","onDeleteFile"])],64)}var N=f(C,[["render",T]]);export{N as default};
