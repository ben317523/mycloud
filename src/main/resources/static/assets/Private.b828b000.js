import{_ as h,a as g}from"./TheFileTable.60d76abf.js";import{_ as f,g as w,T as u,r,o as p,h as F,a as c,n as _,i as b,j as v,v as P,F as y}from"./index.215449f9.js";import"./index.e3edb5c8.js";const C={components:{TheFileViewer:h,CancellableProcess:w,TheFileTable:g,TheSystemInfo:u},data(){return{allFile:[],downloadFileName:"",dialogVisible:!1,previewName:"",downloadPercentage:0,showDownloadProcess:!1,controller:new AbortController,sysInfo:{total:0,used:0,free:0}}},computed:{downloadConfig(){var o=this;return{responseType:"blob",onDownloadProgress:function(e){if(e.lengthComputable){o.showDownloadProcess=!0;var a=Math.round(e.loaded*100/e.total);o.downloadPercentage=a}},signal:o.controller.signal}}},created(){this.getSysInfo(),this.getAllPrivateFileInfo()},methods:{getSysInfo(){var o=this;o.$request.get("/sysInfo").then(e=>{e.data.code==0?(o.sysInfo.total=e.data.data.total,o.sysInfo.used=e.data.data.used,o.sysInfo.free=e.data.data.free):o.$message.error(e.data.msg)}).catch(e=>{o.$message.error(e)})},getAllPrivateFileInfo(){var o=this;o.$request.get(`/getUserFiles?name=${o.$cookies.get("name")}`).then(e=>{e.data.code==0?(o.allFile=e.data.data,console.log(o.allFile)):o.$message.error(e.data.msg)}).catch(e=>{o.$message.error(e.message+" "+e.code)})},download(o){var e=this;this.downloadFileName=o,this.$request.get(`/download?param=${e.downloadFileName}&isPublic=false&name=${e.$cookies.get("name")}`,e.downloadConfig).then(a=>{const{data:n,headers:l}=a,s=l["content-disposition"].replace(/\w+;\s+filename="(.*)"/,"$1"),d=new Blob([n],{type:l["content-type"]});let t=document.createElement("a"),i=window.URL.createObjectURL(d);t.href=i,t.download=decodeURI(s),t.style.display="none",document.body.appendChild(t),t.click(),t.parentNode.removeChild(t),window.URL.revokeObjectURL(i)}).catch(a=>{}).finally(()=>{e.showDownloadProcess=!1,e.downloadPercentage=0})},deleteFile(o){var e=this;e.$confirm("the file will be deleted. Continue?","Warning",{confirmButtonText:"OK",cancelButtonText:"Cancel",type:"warning"}).then(()=>{e.$request.delete(`/delete?name=${o}&uname=${e.$cookies.get("name")}&isPublic=false`).then(a=>{a.data.code==0?(e.$message.success(a.data.msg),e.getAllPrivateFileInfo()):e.$message.error(a.data.msg)}).catch(a=>{e.$message.error(a.message)})}).catch(()=>{})},previewFile(o){var e=this;e.previewName=o,e.dialogVisible=!0},closePreview(o){var e=this;e.dialogVisible=!1,e.previewName=""},formatSize(o){let e=o/1024;if(Math.round(e)>1024){let a=e.toFixed(6)/1024;if(Math.round(a)>1024){let n=a.toFixed(6)/1024;return parseFloat(n).toFixed(3)+" GB"}return parseFloat(a).toFixed(3)+" MB"}return parseFloat(e).toFixed(3)+" KB"},cancelDownload(){var o=this;o.controller.abort(),o.showProgress=!1,o.percentage=0,o.controller=new AbortController,o.$message.warning("Cancel")}}};function $(o,e,a,n,l,s){const d=r("TheFileViewer"),t=r("TheSystemInfo"),i=r("CancellableProcess"),m=r("TheFileTable");return p(),F(y,null,[c(d,{dialogVisible:l.dialogVisible,fileName:l.previewName,onCloseDialog:s.closePreview},null,8,["dialogVisible","fileName","onCloseDialog"]),c(t,_(b(l.sysInfo)),null,16),v(c(i,{processPercentage:l.downloadPercentage,onCancelProcess:s.cancelDownload},null,8,["processPercentage","onCancelProcess"]),[[P,l.showDownloadProcess]]),c(m,{allFile:l.allFile,onDownload:s.download,onPreviewFile:s.previewFile,onDeleteFile:s.deleteFile},null,8,["allFile","onDownload","onPreviewFile","onDeleteFile"])],64)}var N=f(C,[["render",$]]);export{N as default};
